<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>DJ Panel ‚Äî asong.live</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --black: #0a0a0a; --white: #f5f5f0; --gray-100: #f0f0eb;
    --gray-200: #e0e0d8; --gray-400: #999990; --gray-600: #555550;
    --green: #1a6b3a; --green-light: #e8f5ee;
    --red: #8b1a1a; --red-light: #fceaea;
    --gold: #b8960c; --gold-light: #fdf8e6;
    --blue: #1a3a6b; --blue-light: #e8eef5;
  }
  body { background: var(--gray-100); color: var(--black); font-family: 'DM Sans', sans-serif; min-height: 100vh; }

  /* LOGIN */
  #loginScreen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--black); }
  .login-logo { font-family: 'Bebas Neue', sans-serif; font-size: 4rem; color: var(--white); letter-spacing: 4px; line-height: 1; margin-bottom: 8px; text-align: center; }
  .login-sub { color: var(--gray-400); font-size: 0.8rem; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 48px; text-align: center; }
  .login-card { background: var(--white); border-radius: 4px; padding: 40px; width: 320px; }
  .login-card label { font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; color: var(--gray-600); display: block; margin-bottom: 8px; }
  .login-card input { width: 100%; border: 1.5px solid var(--gray-200); border-radius: 2px; padding: 12px 16px; font-family: 'DM Sans', sans-serif; font-size: 1rem; color: var(--black); outline: none; transition: border .2s; letter-spacing: 2px; text-align: center; }
  .login-card input:focus { border-color: var(--black); }
  .btn-login { width: 100%; margin-top: 16px; padding: 14px; background: var(--black); color: var(--white); border: none; border-radius: 2px; font-family: 'DM Sans', sans-serif; font-size: 0.8rem; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: opacity .2s; }
  .btn-login:hover { opacity: 0.8; }
  .login-error { color: var(--red); font-size: 0.78rem; margin-top: 12px; display: none; text-align: center; }

  /* PANEL */
  #djPanel { display: none; min-height: 100vh; }
  .dj-header { background: var(--black); color: var(--white); padding: 16px 24px; display: flex; align-items: center; gap: 16px; }
  .dj-logo-area { display: flex; align-items: center; gap: 20px; flex: 1; min-width: 0; }
  .dj-logo-placeholder { width: 52px; height: 52px; border-radius: 4px; background: #1a1a1a; border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
  .dj-logo-img { width: 52px; height: 52px; border-radius: 4px; object-fit: cover; border: 1px solid #333; display: none; }
  .dj-event-name { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 2px; line-height: 1; }
  .dj-subtitle { color: var(--gray-400); font-size: 0.75rem; letter-spacing: 1px; margin-top: 3px; }
  .ws-dot { width: 8px; height: 8px; border-radius: 50%; background: #555; transition: background .3s; }
  .ws-dot.live { background: #4caf50; box-shadow: 0 0 8px #4caf50; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
  .ws-label { font-size: 0.72rem; letter-spacing: 1px; color: var(--gray-400); text-transform: uppercase; margin-left: 8px; }

  .stats-bar { background: var(--white); border-bottom: 1px solid var(--gray-200); padding: 0 32px; display: flex; }
  .stat-item { padding: 16px 24px; border-right: 1px solid var(--gray-200); text-align: center; min-width: 100px; }
  .stat-item:last-child { border-right: none; }
  .stat-num { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; line-height: 1; }
  .stat-label { font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase; color: var(--gray-400); margin-top: 2px; }

  .main-content { display: flex; height: calc(100vh - 130px); }
  .queue-panel { flex: 1; overflow-y: auto; padding: 24px; border-right: 1px solid var(--gray-200); }
  .queue-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .queue-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 2px; }
  .filter-pills { display: flex; gap: 6px; }
  .pill { padding: 5px 14px; border-radius: 20px; font-size: 0.72rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; border: 1.5px solid var(--gray-200); background: transparent; color: var(--gray-400); cursor: pointer; transition: all .2s; }
  .pill.active { background: var(--black); color: var(--white); border-color: var(--black); }

  .song-card { background: var(--white); border-radius: 4px; border: 1.5px solid var(--gray-200); margin-bottom: 10px; overflow: hidden; transition: all .2s; animation: slideIn .3s ease; }
  @keyframes slideIn { from{opacity:0;transform:translateY(-10px)} to{opacity:1;transform:translateY(0)} }
  .song-card:hover { border-color: var(--black); }
  .song-inner { padding: 14px 16px; display: flex; gap: 14px; align-items: flex-start; }
  .song-rank { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; color: var(--gray-200); line-height: 1; min-width: 32px; text-align: center; margin-top: 4px; }
  .song-cover { width: 56px; height: 56px; border-radius: 3px; object-fit: cover; flex-shrink: 0; }
  .song-name { font-weight: 700; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .song-artist { color: var(--gray-600); font-size: 0.8rem; margin-top: 2px; }
  .song-dedicatoria { background: var(--gray-100); border-left: 2px solid var(--gray-200); padding: 6px 10px; margin-top: 8px; font-size: 0.78rem; color: var(--gray-600); font-style: italic; border-radius: 0 2px 2px 0; }
  .song-meta { display: flex; gap: 8px; align-items: center; margin-top: 6px; }
  .votes-badge { font-size: 0.7rem; font-weight: 700; padding: 2px 8px; background: var(--black); color: var(--white); border-radius: 20px; }
  .status-badge { font-size: 0.65rem; font-weight: 600; padding: 2px 8px; border-radius: 20px; letter-spacing: 1px; text-transform: uppercase; }
  .status-pendiente { background: var(--gray-100); color: var(--gray-400); }
  .status-aprobada { background: var(--green-light); color: var(--green); }
  .song-actions { padding: 0 16px 14px 62px; display: flex; gap: 8px; flex-wrap: wrap; }
  .song-card.mensaje { border-color: #285AEB; background: rgba(40,90,235,0.05); }
  .song-card.mensaje::before { background: #285AEB !important; }
  .mensaje-badge { font-size:0.6rem; font-weight:700; letter-spacing:2px; text-transform:uppercase; padding:3px 8px; border-radius:20px; background:rgba(40,90,235,0.15); color:#285AEB; border:1px solid #285AEB; }
  .act-btn { padding: 8px 20px; border-radius: 20px; font-family: 'DM Sans', sans-serif; font-size: 0.72rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; border: 1.5px solid; transition: all .15s; background: var(--white); }
  .act-approve { background: var(--green-light); color: var(--green); border-color: var(--green); }
  .act-approve:hover { background: var(--green); color: var(--white); }
  .act-play { background: var(--blue-light); color: var(--blue); border-color: var(--blue); }
  .act-play:hover { background: var(--blue); color: var(--white); }
  .act-reject { background: var(--red-light); color: var(--red); border-color: var(--red); }
  .act-reject:hover { background: var(--red); color: var(--white); }
  .act-next { background: var(--gold-light); color: var(--gold); border-color: var(--gold); }
  .act-next:hover { background: var(--gold); color: var(--white); }

  .controls-panel { width: 300px; flex-shrink: 0; padding: 24px; overflow-y: auto; background: var(--white); border-left: 1px solid var(--gray-200); }
  .ctrl-section { margin-bottom: 28px; }
  .ctrl-title { font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 2px; color: var(--gray-400); margin-bottom: 12px; border-bottom: 1px solid var(--gray-200); padding-bottom: 8px; }
  .setup-field { margin-bottom: 12px; }
  .setup-field label { font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase; color: var(--gray-400); display: block; margin-bottom: 5px; }
  .setup-field input { width: 100%; border: 1.5px solid var(--gray-200); border-radius: 2px; padding: 9px 12px; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; color: var(--black); outline: none; transition: border .2s; }
  .setup-field input:focus { border-color: var(--black); }
  .btn-save { width: 100%; padding: 10px; background: var(--black); color: var(--white); border: none; border-radius: 2px; font-family: 'DM Sans', sans-serif; font-size: 0.72rem; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; margin-top: 4px; transition: opacity .2s; }
  .btn-save:hover { opacity: 0.75; }

  .tip-btn { width: 100%; padding: 12px 16px; border-radius: 3px; border: 1.5px solid var(--gray-200); background: var(--gray-100); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all .2s; margin-bottom: 8px; font-family: 'DM Sans', sans-serif; }
  .tip-btn:hover { border-color: var(--black); background: var(--gray-100); }
  .tip-icon { font-size: 1.3rem; }
  .tip-name { font-weight: 700; font-size: 0.85rem; }
  .tip-handle { font-size: 0.72rem; color: var(--gray-400); }

  .empty { text-align: center; padding: 60px 20px; color: var(--gray-400); }
  .empty-icon { font-size: 3rem; margin-bottom: 12px; }
  .empty-text { font-size: 0.85rem; letter-spacing: 1px; }

  .notif { position: fixed; top: 20px; right: 20px; z-index: 999; background: var(--black); color: var(--white); padding: 14px 20px; border-radius: 3px; font-size: 0.85rem; font-weight: 600; transform: translateX(120%); transition: transform .3s; max-width: 280px; border-left: 3px solid var(--white); }
  .notif.show { transform: translateX(0); }
  .notif.success { border-left-color: #4caf50; }
  .notif.warning { border-left-color: var(--gold); }

  /* ‚îÄ‚îÄ TABLET MODE ‚îÄ‚îÄ */
  .drawer-btn { display: none; }
  @media (min-width: 1101px) { .controls-panel { display: block !important; } .drawer-btn { display: none !important; } }
  .drawer-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200; }
  .drawer-overlay.show { display: block; }
  .drawer { position: fixed; right: -340px; top: 0; bottom: 0; width: 320px; background: var(--white); z-index: 201; transition: right .3s; overflow-y: auto; padding: 24px; border-left: 1px solid var(--gray-200); }
  .drawer.show { right: 0; }
  .drawer-close { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--gray-400); }

  @media (max-width: 1100px) {
    .controls-panel { display: none; }
    .drawer-btn { display: flex; align-items: center; gap: 8px; background: var(--white); border: 1.5px solid var(--gray-200); border-radius: 3px; padding: 8px 14px; font-family: "DM Sans", sans-serif; font-size: 0.75rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; transition: all .2s; }
    .drawer-btn:hover { border-color: var(--black); }
    .dj-header { padding: 14px 16px; }
    .dj-event-name { font-size: 1.3rem; }
    .stat-item { padding: 12px 16px; min-width: 70px; }
    .stat-num { font-size: 1.6rem; }
    .stat-label { font-size: 0.6rem; }
    .queue-panel { padding: 16px; }
    .main-content { height: calc(100vh - 120px); }
    .queue-header { flex-wrap: wrap; gap: 8px; }
  }

  @media (max-width: 700px) {
    .stat-item { padding: 10px 10px; min-width: 60px; }
    .stat-num { font-size: 1.4rem; }
    .stats-bar { padding: 0 16px; }
  }
</style>
</head>
<body>

<div id="loginScreen">
  <div>
    <div style="margin-bottom:20px"><div style="display:flex;align-items:center;gap:14px;justify-content:center">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 60" width="28" height="42">
    <rect x="0" y="15" width="4" height="30" fill="#FF6B2B" rx="2" opacity="0.4"/>
    <rect x="8" y="8" width="4" height="44" fill="#FF6B2B" rx="2" opacity="0.7"/>
    <rect x="16" y="0" width="4" height="60" fill="#FF6B2B" rx="2"/>
    <rect x="24" y="10" width="4" height="40" fill="#FF6B2B" rx="2" opacity="0.7"/>
    <rect x="32" y="20" width="4" height="20" fill="#FF6B2B" rx="2" opacity="0.4"/>
  </svg>
  <span style="font-family:'Bebas Neue','Arial Black',sans-serif;font-size:2.8rem;letter-spacing:3px;color:#f5f5f0;line-height:1">asong<span style="color:#FF6B2B">.live</span></span>
</div></div>
    <div class="login-sub">DJ Control Panel</div>
    <div class="login-card">
      <label>Contrase√±a</label>
      <input type="password" id="pwdInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')login()">
      <button class="btn-login" onclick="login()">Entrar</button>
      <p class="login-error" id="loginError">Contrase√±a incorrecta</p>
    </div>
  </div>
</div>

<div id="djPanel">
  <div class="dj-header">
    <div class="dj-logo-area">
      <div id="logoPlaceholder" style="background:transparent;border:none;padding:0;flex-shrink:0"><div style="display:flex;align-items:center;gap:10px">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 60" width="20" height="30">
    <rect x="0" y="15" width="4" height="30" fill="#FF6B2B" rx="2" opacity="0.4"/>
    <rect x="8" y="8" width="4" height="44" fill="#FF6B2B" rx="2" opacity="0.7"/>
    <rect x="16" y="0" width="4" height="60" fill="#FF6B2B" rx="2"/>
    <rect x="24" y="10" width="4" height="40" fill="#FF6B2B" rx="2" opacity="0.7"/>
    <rect x="32" y="20" width="4" height="20" fill="#FF6B2B" rx="2" opacity="0.4"/>
  </svg>
  <span style="font-family:'Bebas Neue','Arial Black',sans-serif;font-size:1.6rem;letter-spacing:2px;color:#f5f5f0;line-height:1">asong<span style="color:#FF6B2B">.live</span></span>
</div></div>
      <img class="dj-logo-img" id="logoImg" src="" alt="">
      <div>
        <div class="dj-event-name" id="headerEventName">Mi Evento</div>
        <div class="dj-subtitle" id="headerSubtitle">DJ Request System</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <a href="/display" target="_blank" style="padding:7px 14px;background:var(--black);color:var(--white);border:1.5px solid #333;border-radius:20px;font-size:0.7rem;font-weight:700;letter-spacing:1px;text-decoration:none;white-space:nowrap">‚õ∂ Display</a>
      <div class="ws-dot" id="wsDot"></div>
      <span class="ws-label" id="wsLabel">Conectando</span>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat-item"><div class="stat-num" id="statTotal">0</div><div class="stat-label">Total</div></div>
    <div class="stat-item"><div class="stat-num" id="statPendientes">0</div><div class="stat-label">Pendientes</div></div>
    <div class="stat-item"><div class="stat-num" id="statAprobadas">0</div><div class="stat-label">Aprobadas</div></div>
    <div class="stat-item"><div class="stat-num" id="statVotos">0</div><div class="stat-label">Votos</div></div>
    <div style="margin-left:auto;padding:0 16px;display:flex;align-items:center">
      <a href="/display" target="_blank" style="padding:8px 18px;background:var(--black);color:var(--white);border-radius:20px;font-size:0.72rem;font-weight:700;letter-spacing:1px;text-decoration:none;white-space:nowrap">‚õ∂ Open Display</a>
    </div>
  </div>

  <!-- MESSAGE BOARD PANEL - siempre visible -->
  <div style="background:var(--white);border-bottom:1.5px solid var(--gray-200);padding:12px 16px">
    <div style="display:flex;gap:8px;align-items:flex-start">
      <div style="flex:1">
        <div style="font-size:0.65rem;letter-spacing:2px;text-transform:uppercase;color:var(--gray-400);margin-bottom:6px">üì¢ Display Message</div>
        <textarea id="djMessageMain" rows="2" placeholder="Felicidades Mr & Mrs Douglas üíç&#10;Para bookings: 555-1234" 
          style="width:100%;background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:8px 10px;font-family:'DM Sans',sans-serif;font-size:0.85rem;resize:none;outline:none;transition:border .2s;color:var(--black)"
          onfocus="this.style.borderColor='var(--black)'" onblur="this.style.borderColor='var(--gray-200)'"
          oninput="syncMsgBoards(this)"></textarea>
        <div id="msgPreview" style="margin-top:4px;font-size:0.75rem;color:var(--gray-400);min-height:16px;font-style:italic"></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;flex-shrink:0;padding-top:20px">
        <button onclick="sendMessageMain('orange')" style="padding:8px 14px;background:var(--orange);color:#fff;border:none;border-radius:20px;font-size:0.7rem;font-weight:700;letter-spacing:1px;cursor:pointer;white-space:nowrap">üî• Destaca</button>

      </div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px">
      <button onclick="addEmojiMain('üíç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">üíç</button>
      <button onclick="addEmojiMain('üéµ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">üéµ</button>
      <button onclick="addEmojiMain('üî•')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">üî•</button>
      <button onclick="addEmojiMain('üéâ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">üéâ</button>
      <button onclick="addEmojiMain('‚ù§Ô∏è')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">‚ù§Ô∏è</button>
      <button onclick="addEmojiMain('üé∂')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">üé∂</button>
      <button onclick="addEmojiMain('‚≠ê')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">‚≠ê</button>
      <button onclick="addEmojiMain('ü•Ç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:0.9rem">ü•Ç</button>
      <button onclick="sendMessageMain('white')" style="padding:6px 16px;background:var(--black);color:var(--white);border:none;border-radius:8px;font-size:0.8rem;font-weight:700;letter-spacing:1px;cursor:pointer">üì§ Send</button>
      <button onclick="clearMessageMain()" style="padding:6px 14px;background:transparent;color:var(--gray-400);border:1.5px solid var(--gray-200);border-radius:8px;font-size:0.8rem;font-weight:700;cursor:pointer">‚úï Clear</button>
    </div>
  </div>

  <div class="main-content">
    <div class="queue-panel">
      <div class="queue-header">
        <div class="queue-title">Cola de Solicitudes</div>
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <div class="filter-pills">
            <button class="pill active" onclick="setFilter('todas',this)">Todas</button>
            <button class="pill" onclick="setFilter('pendiente',this)">Pendientes</button>
            <button class="pill" onclick="setFilter('aprobada',this)">Aprobadas</button>
          </div>
          <button class="drawer-btn" onclick="openDrawer()">‚öôÔ∏è Config</button>
        </div>
      </div>
      <div id="queueContainer"><div class="empty"><div class="empty-icon">üéµ</div><div class="empty-text">Sin solicitudes a√∫n</div></div></div>
    </div>

    <div class="controls-panel">
      <div class="ctrl-section">
        <div class="ctrl-title">Personalizaci√≥n</div>
        <div class="setup-field"><label>Nombre del evento</label><input type="text" id="cfgEventName" placeholder="Ej: Boda de Mar√≠a" oninput="updateHeader()"></div>
        <div class="setup-field"><label>Subt√≠tulo / Slogan</label><input type="text" id="cfgSubtitle" placeholder="Ej: La m√∫sica m√°s cool" oninput="updateHeader()"></div>
        <div class="setup-field"><label>URL del logo</label><input type="text" id="cfgLogo" placeholder="https://..." oninput="updateLogo()"></div>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">üåê Redes Sociales</div>
        <div class="setup-field"><label>Instagram</label><input type="text" id="cfgInstagram" placeholder="@tuusuario"></div>
        <div class="setup-field"><label>TikTok</label><input type="text" id="cfgTiktok" placeholder="@tuusuario"></div>
        <div class="setup-field"><label>Facebook</label><input type="text" id="cfgFacebook" placeholder="tu p√°gina o perfil"></div>
        <div class="setup-field"><label>Spotify</label><input type="text" id="cfgSpotifyDj" placeholder="link o usuario"></div>
        <div class="setup-field"><label>Website</label><input type="text" id="cfgWebsite" placeholder="www.tuweb.com"></div>
        <button class="btn-save" onclick="saveConfig()">Guardar redes</button>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">Links de Propina</div>
        <div class="setup-field"><label>Texto del bot√≥n</label><input type="text" id="cfgLoveText" placeholder="Show Your Love üíõ"></div>
        <div class="setup-field"><label>Cash App ($cashtag)</label><input type="text" id="cfgCashapp" placeholder="$tuusuario"></div>
        <div class="setup-field"><label>Venmo (@usuario)</label><input type="text" id="cfgVenmo" placeholder="@tuusuario"></div>
        <div class="setup-field"><label>Apple Pay (email)</label><input type="text" id="cfgApplepay" placeholder="tu@email.com"></div>
        <button class="btn-save" onclick="saveConfig()">Guardar configuraci√≥n</button>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">üåê Redes Sociales</div>
        <div class="setup-field"><label>Instagram</label><input type="text" id="cfgInstagram2" placeholder="@tuusuario" oninput="syncConfig('cfgInstagram','cfgInstagram2',this)"></div>
        <div class="setup-field"><label>TikTok</label><input type="text" id="cfgTiktok2" placeholder="@tuusuario" oninput="syncConfig('cfgTiktok','cfgTiktok2',this)"></div>
        <div class="setup-field"><label>Facebook</label><input type="text" id="cfgFacebook2" placeholder="tu p√°gina" oninput="syncConfig('cfgFacebook','cfgFacebook2',this)"></div>
        <div class="setup-field"><label>Spotify</label><input type="text" id="cfgSpotifyDj2" placeholder="link o usuario" oninput="syncConfig('cfgSpotifyDj','cfgSpotifyDj2',this)"></div>
        <div class="setup-field"><label>Website</label><input type="text" id="cfgWebsite2" placeholder="www.tuweb.com" oninput="syncConfig('cfgWebsite','cfgWebsite2',this)"></div>
        <button class="btn-save" onclick="saveConfig()">Guardar redes</button>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">üì¢ DJ Message Board</div>
        <div class="setup-field">
          <label>Message for the screen</label>
          <textarea id="djMessage" rows="3" placeholder="Felicidades Mr & Mrs Douglas üíç&#10;Para bookings: 555-1234&#10;Esta canci√≥n va dedicada a Sara ü§ç" style="width:100%;background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:10px;font-family:DM Sans,sans-serif;font-size:0.85rem;resize:none;outline:none;transition:border .2s" onfocus="this.style.borderColor='var(--black)'" onblur="this.style.borderColor='var(--gray-200)'"></textarea>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
          <button onclick="addEmoji('üíç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üíç</button>
          <button onclick="addEmoji('üéµ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üéµ</button>
          <button onclick="addEmoji('üî•')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üî•</button>
          <button onclick="addEmoji('üéâ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üéâ</button>
          <button onclick="addEmoji('‚ù§Ô∏è')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">‚ù§Ô∏è</button>
          <button onclick="addEmoji('üé∂')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üé∂</button>
          <button onclick="addEmoji('‚≠ê')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">‚≠ê</button>
          <button onclick="addEmoji('ü•Ç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">ü•Ç</button>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn-save" onclick="sendMessage('white')" style="flex:1">üì§ Send</button>
          <button class="btn-save" onclick="sendMessage('orange')" style="flex:1;background:var(--orange);color:#fff">üî• Highlight</button>
          <button class="btn-save" onclick="clearMessage()" style="flex:1;background:transparent;border:1.5px solid var(--gray-200);color:var(--gray-600)">‚úï Clear</button>
        </div>
        <div style="margin-top:8px">
          <a href="/display" target="_blank" style="display:block;text-align:center;padding:10px;background:var(--black);color:var(--white);border-radius:3px;font-size:0.72rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;text-decoration:none">‚õ∂ Open Display Screen</a>
        </div>
      </div>
      <div style="display:none">
      </div>
      <div class="ctrl-section" id="tipSection" style="display:none">
        <div class="ctrl-title" id="tipTitle">üíõ Show Your Love</div>
        <button class="tip-btn" id="btnCashapp" onclick="abrirPropina('cashapp')" style="display:none"><span class="tip-icon">üíµ</span><div><div class="tip-name">Cash App</div><div class="tip-handle" id="labelCashapp"></div></div></button>
        <button class="tip-btn" id="btnVenmo" onclick="abrirPropina('venmo')" style="display:none"><span class="tip-icon">üíô</span><div><div class="tip-name">Venmo</div><div class="tip-handle" id="labelVenmo"></div></div></button>
        <button class="tip-btn" id="btnApplepay" onclick="abrirPropina('applepay')" style="display:none"><span class="tip-icon">üçé</span><div><div class="tip-name">Apple Pay</div><div class="tip-handle" id="labelApplepay"></div></div></button>
      </div>
    </div>
  </div>
</div>

<div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
  <button class="drawer-close" onclick="closeDrawer()">‚úï</button>
  <div style="margin-top:32px">
    <div class="ctrl-section">
      <div class="ctrl-title">Personalizaci√≥n</div>
      <div class="setup-field"><label>Nombre del evento</label><input type="text" id="cfgEventName2" placeholder="Ej: Boda de Mar√≠a" oninput="syncConfig('cfgEventName','cfgEventName2',this)"></div>
      <div class="setup-field"><label>Subt√≠tulo / Slogan</label><input type="text" id="cfgSubtitle2" placeholder="Ej: La m√∫sica m√°s cool" oninput="syncConfig('cfgSubtitle','cfgSubtitle2',this)"></div>
      <div class="setup-field"><label>URL del logo</label><input type="text" id="cfgLogo2" placeholder="https://..." oninput="syncConfig('cfgLogo','cfgLogo2',this)"></div>
    </div>
    <div class="ctrl-section">
      <div class="ctrl-title">Show Your Love üíõ</div>
      <div class="setup-field"><label>Texto del bot√≥n</label><input type="text" id="cfgLoveText2" placeholder="Show Your Love üíõ" oninput="syncConfig('cfgLoveText','cfgLoveText2',this)"></div>
      <div class="setup-field"><label>Cash App ($cashtag)</label><input type="text" id="cfgCashapp2" placeholder="$tuusuario" oninput="syncConfig('cfgCashapp','cfgCashapp2',this)"></div>
      <div class="setup-field"><label>Venmo (@usuario)</label><input type="text" id="cfgVenmo2" placeholder="@tuusuario" oninput="syncConfig('cfgVenmo','cfgVenmo2',this)"></div>
      <div class="setup-field"><label>Apple Pay (email)</label><input type="text" id="cfgApplepay2" placeholder="tu@email.com" oninput="syncConfig('cfgApplepay','cfgApplepay2',this)"></div>
      <button class="btn-save" onclick="saveConfig()">Guardar configuraci√≥n</button>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">üåê Redes Sociales</div>
        <div class="setup-field"><label>Instagram</label><input type="text" id="cfgInstagram2" placeholder="@tuusuario" oninput="syncConfig('cfgInstagram','cfgInstagram2',this)"></div>
        <div class="setup-field"><label>TikTok</label><input type="text" id="cfgTiktok2" placeholder="@tuusuario" oninput="syncConfig('cfgTiktok','cfgTiktok2',this)"></div>
        <div class="setup-field"><label>Facebook</label><input type="text" id="cfgFacebook2" placeholder="tu p√°gina" oninput="syncConfig('cfgFacebook','cfgFacebook2',this)"></div>
        <div class="setup-field"><label>Spotify</label><input type="text" id="cfgSpotifyDj2" placeholder="link o usuario" oninput="syncConfig('cfgSpotifyDj','cfgSpotifyDj2',this)"></div>
        <div class="setup-field"><label>Website</label><input type="text" id="cfgWebsite2" placeholder="www.tuweb.com" oninput="syncConfig('cfgWebsite','cfgWebsite2',this)"></div>
        <button class="btn-save" onclick="saveConfig()">Guardar redes</button>
      </div>
      <div class="ctrl-section">
        <div class="ctrl-title">üì¢ DJ Message Board</div>
        <div class="setup-field">
          <label>Message for the screen</label>
          <textarea id="djMessage" rows="3" placeholder="Felicidades Mr & Mrs Douglas üíç&#10;Para bookings: 555-1234&#10;Esta canci√≥n va dedicada a Sara ü§ç" style="width:100%;background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:10px;font-family:DM Sans,sans-serif;font-size:0.85rem;resize:none;outline:none;transition:border .2s" onfocus="this.style.borderColor='var(--black)'" onblur="this.style.borderColor='var(--gray-200)'"></textarea>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
          <button onclick="addEmoji('üíç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üíç</button>
          <button onclick="addEmoji('üéµ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üéµ</button>
          <button onclick="addEmoji('üî•')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üî•</button>
          <button onclick="addEmoji('üéâ')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üéâ</button>
          <button onclick="addEmoji('‚ù§Ô∏è')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">‚ù§Ô∏è</button>
          <button onclick="addEmoji('üé∂')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">üé∂</button>
          <button onclick="addEmoji('‚≠ê')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">‚≠ê</button>
          <button onclick="addEmoji('ü•Ç')" style="background:var(--gray-100);border:1.5px solid var(--gray-200);border-radius:3px;padding:6px 10px;cursor:pointer;font-size:1rem">ü•Ç</button>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn-save" onclick="sendMessage('white')" style="flex:1">üì§ Send</button>
          <button class="btn-save" onclick="sendMessage('orange')" style="flex:1;background:var(--orange);color:#fff">üî• Highlight</button>
          <button class="btn-save" onclick="clearMessage()" style="flex:1;background:transparent;border:1.5px solid var(--gray-200);color:var(--gray-600)">‚úï Clear</button>
        </div>
        <div style="margin-top:8px">
          <a href="/display" target="_blank" style="display:block;text-align:center;padding:10px;background:var(--black);color:var(--white);border-radius:3px;font-size:0.72rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;text-decoration:none">‚õ∂ Open Display Screen</a>
        </div>
      </div>
      <div style="display:none">
    </div>
  </div>
</div>
<div class="notif" id="notif"></div>

<script>
let PASSWORD=localStorage.getItem('djpass')||'', solicitudes=[], filtro='todas', ws;
let config = JSON.parse(localStorage.getItem('djConfig')||'{}');

// Auto-login si hay password guardado
window.addEventListener('load', async () => {
  if (PASSWORD) {
    const res = await fetch(`/api/dj/solicitudes?password=${encodeURIComponent(PASSWORD)}`);
    if (res.ok) {
      const rawSols = await res.json();
      solicitudes = rawSols.map(s => ({...s, tipo: s.tipo || 'cancion'}));
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('djPanel').style.display = 'block';
      loadConfig(); renderQueue(); conectarWS();
    } else { localStorage.removeItem('djpass'); PASSWORD = ''; }
  }
});

async function login() {
  const pwd = document.getElementById('pwdInput').value;
  const res = await fetch(`/api/dj/solicitudes?password=${encodeURIComponent(pwd)}`);
  if (res.ok) {
    PASSWORD = pwd; localStorage.setItem('djpass', pwd);
    const rawSols = await res.json();
      solicitudes = rawSols.map(s => ({...s, tipo: s.tipo || 'cancion'}));
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('djPanel').style.display = 'block';
    loadConfig(); renderQueue(); conectarWS();
  } else { document.getElementById('loginError').style.display = 'block'; }
}

async function loadConfig() {
  try {
    const res = await fetch('/api/dj/config?password=' + encodeURIComponent(PASSWORD));
    if (res.ok) {
      const cfg = await res.json();
      document.getElementById('cfgEventName').value = cfg.event_name || '';
      document.getElementById('cfgSubtitle').value = cfg.subtitle || '';
      document.getElementById('cfgLogo').value = cfg.logo_url || '';
      if(document.getElementById('cfgInstagram')) document.getElementById('cfgInstagram').value = cfg.instagram || '';
      if(document.getElementById('cfgInstagram2')) document.getElementById('cfgInstagram2').value = cfg.instagram || '';
      if(document.getElementById('cfgTiktok2')) document.getElementById('cfgTiktok2').value = cfg.tiktok || '';
      if(document.getElementById('cfgFacebook2')) document.getElementById('cfgFacebook2').value = cfg.facebook || '';
      if(document.getElementById('cfgSpotifyDj2')) document.getElementById('cfgSpotifyDj2').value = cfg.spotify_dj || '';
      if(document.getElementById('cfgWebsite2')) document.getElementById('cfgWebsite2').value = cfg.website || '';
      if(document.getElementById('cfgTiktok')) document.getElementById('cfgTiktok').value = cfg.tiktok || '';
      if(document.getElementById('cfgFacebook')) document.getElementById('cfgFacebook').value = cfg.facebook || '';
      if(document.getElementById('cfgSpotifyDj')) document.getElementById('cfgSpotifyDj').value = cfg.spotify_dj || '';
      if(document.getElementById('cfgWebsite')) document.getElementById('cfgWebsite').value = cfg.website || '';
      document.getElementById('cfgCashapp').value = cfg.cashapp || '';
      document.getElementById('cfgVenmo').value = cfg.venmo || '';
      document.getElementById('cfgApplepay').value = cfg.applepay || '';
      document.getElementById('cfgLoveText').value = cfg.love_text || 'Show Your Love';
      config = { eventName: cfg.event_name, subtitle: cfg.subtitle, logo: cfg.logo_url, cashapp: cfg.cashapp, venmo: cfg.venmo, applepay: cfg.applepay, loveText: cfg.love_text };
    }
  } catch(e) { console.log('Config load error:', e); }
  updateHeader(); updateLogo(); updateTipButtons();
}

function getVal(id) {
  const a = document.getElementById(id);
  const b = document.getElementById(id+'2');
  return (a&&a.value) ? a.value : (b&&b.value) ? b.value : '';
}

async function saveConfig() {
  const newConfig = {
    password: PASSWORD,
    event_name: getVal('cfgEventName'),
    subtitle: getVal('cfgSubtitle'),
    logo_url: getVal('cfgLogo'),
    cashapp: getVal('cfgCashapp'),
    venmo: getVal('cfgVenmo'),
    applepay: getVal('cfgApplepay'),
    love_text: getVal('cfgLoveText') || 'Show Your Love',
    instagram: getVal('cfgInstagram'),
    tiktok: getVal('cfgTiktok'),
    facebook: getVal('cfgFacebook'),
    spotify_dj: getVal('cfgSpotifyDj'),
    website: getVal('cfgWebsite'),
  };
  const res = await fetch('/api/dj/config', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(newConfig)
  });
  if (res.ok) {
    config = { eventName: newConfig.event_name, subtitle: newConfig.subtitle, logo: newConfig.logo_url, cashapp: newConfig.cashapp, venmo: newConfig.venmo, applepay: newConfig.applepay, loveText: newConfig.love_text };
    updateHeader(); updateLogo(); updateTipButtons();
    showNotif('‚úÖ Configuraci√≥n guardada', 'success');
  } else {
    showNotif('‚ùå Error al guardar', '');
  }
}

function updateHeader() {
  document.getElementById('headerEventName').textContent = document.getElementById('cfgEventName').value || 'Mi Evento';
  document.getElementById('headerSubtitle').textContent = document.getElementById('cfgSubtitle').value || 'DJ Request System';
}

function updateLogo() {
  const url = document.getElementById('cfgLogo').value;
  const img = document.getElementById('logoImg');
  const ph = document.getElementById('logoPlaceholder');
  if (url) { img.src = url; img.style.display='block'; ph.style.display='none'; }
  else { img.style.display='none'; ph.style.display='flex'; }
}

function updateTipButtons() {
  const ca = config.cashapp||'', ve = config.venmo||'', ap = config.applepay||'';
  document.getElementById('tipSection').style.display = (ca||ve||ap) ? 'block' : 'none';
  const tipTitle = document.getElementById('tipTitle');
  if (tipTitle) tipTitle.textContent = 'üíõ ' + (config.loveText || 'Show Your Love');
  if (ca) { document.getElementById('btnCashapp').style.display='flex'; document.getElementById('labelCashapp').textContent=ca; }
  if (ve) { document.getElementById('btnVenmo').style.display='flex'; document.getElementById('labelVenmo').textContent=ve; }
  if (ap) { document.getElementById('btnApplepay').style.display='flex'; document.getElementById('labelApplepay').textContent=ap; }
}

function abrirPropina(tipo) {
  const links = { cashapp:`https://cash.app/${config.cashapp}`, venmo:`https://venmo.com/${(config.venmo||'').replace('@','')}`, applepay:`https://pay.apple.com/` };
  window.open(links[tipo],'_blank');
}

function openDrawer() {
  // Sincronizar valores del panel derecho al drawer
  ['EventName','Subtitle','Logo','Cashapp','Venmo','Applepay','LoveText'].forEach(f => {
    const src = document.getElementById('cfg'+f);
    const dst = document.getElementById('cfg'+f+'2');
    if (src && dst) dst.value = src.value;
  });
  document.getElementById('drawer').classList.add('show');
  document.getElementById('drawerOverlay').classList.add('show');
}

function closeDrawer() {
  document.getElementById('drawer').classList.remove('show');
  document.getElementById('drawerOverlay').classList.remove('show');
}

function addEmoji(emoji) {
  const ta = document.getElementById('djMessage');
  if(ta) { ta.value += emoji; ta.focus(); }
}

async function sendMessage(color) {
  const texto = document.getElementById('djMessage')?.value || '';
  if(!texto.trim()) { showNotif('Escribe un mensaje primero', ''); return; }
  const res = await fetch('/api/dj/message', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ password: PASSWORD, texto, color })
  });
  if(res.ok) showNotif('üì¢ Mensaje enviado a la pantalla', 'success');
  else showNotif('Error al enviar', '');
}

async function clearMessage() {
  await fetch('/api/dj/message', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ password: PASSWORD, texto: '', color: 'white' })
  });
  const ta = document.getElementById('djMessage');
  if(ta) ta.value = '';
  showNotif('Mensaje borrado', 'success');
}

function syncConfig(mainId, drawerId, el) {
  const other = el.id === mainId ? document.getElementById(drawerId) : document.getElementById(mainId);
  if (other) other.value = el.value;
  updateHeader(); updateLogo(); updateTipButtons();
}

function conectarWS() {
  const protocol = location.protocol==='https:'?'wss:':'ws:';
  ws = new WebSocket(`${protocol}//${location.host}/ws/dj`);
  ws.onopen = () => { document.getElementById('wsDot').classList.add('live'); document.getElementById('wsLabel').textContent='En vivo'; };
  ws.onclose = () => { document.getElementById('wsDot').classList.remove('live'); document.getElementById('wsLabel').textContent='Reconectando'; setTimeout(conectarWS,3000); };
  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    if (msg.tipo==='nueva_solicitud') {
      // El backend manda los datos directamente en msg
      const solicitud = {id:msg.id, cancion:msg.cancion, artista:msg.artista, portada_url:msg.portada_url||'', dedicatoria:msg.dedicatoria||'', estado:'pendiente', votos:0, tipo:msg.tipo_solicitud||'cancion'};
      solicitudes.unshift(solicitud);
      renderQueue();
      showNotif(`üéµ ${msg.cancion} ‚Äî ${msg.artista}`,'success');
    }
    else if (msg.tipo==='voto') {
      const s = solicitudes.find(x=>x.id===msg.id);
      if(s){ s.votos=msg.votos; renderQueue(); }
    }
    else if (msg.tipo==='estado_actualizado') {
      const s = solicitudes.find(x=>x.id===msg.id);
      if(s){ s.estado=msg.estado; renderQueue(); }
    }
  };
}

function setFilter(f,btn) { filtro=f; document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active')); btn.classList.add('active'); renderQueue(); }

function renderQueue() {
  const filtered = filtro==='todas' ? solicitudes.filter(s=>s.estado!=='reproducida'&&s.estado!=='rechazada') : solicitudes.filter(s=>s.estado===filtro);
  const sorted = [...filtered].sort((a,b)=> b.votos !== a.votos ? b.votos-a.votos : a.id-b.id);
  document.getElementById('statTotal').textContent = solicitudes.length;
  document.getElementById('statPendientes').textContent = solicitudes.filter(s=>s.estado==='pendiente').length;
  document.getElementById('statAprobadas').textContent = solicitudes.filter(s=>s.estado==='aprobada').length;
  document.getElementById('statVotos').textContent = solicitudes.reduce((a,s)=>a+s.votos,0);
  const c = document.getElementById('queueContainer');
  if (!sorted.length) { c.innerHTML='<div class="empty"><div class="empty-icon">üéµ</div><div class="empty-text">Sin solicitudes</div></div>'; return; }
  c.innerHTML = sorted.map((s,i) => `
    <div class="song-card ${s.tipo==='mensaje'?'mensaje':''}" id="card-${s.id}">
      <div class="song-inner">
        <div class="song-rank">${String(i+1).padStart(2,'0')}</div>
        <img class="song-cover" src="${s.portada_url||'https://via.placeholder.com/56'}" alt="">
        <div style="flex:1;min-width:0">
          <div class="song-name">${s.cancion}</div>
          <div class="song-artist">${s.artista}</div>
          ${s.dedicatoria?`<div class="song-dedicatoria">üí¨ "${s.dedicatoria}"</div>`:''}
          <div class="song-meta"><span class="votes-badge">üî• ${s.votos}</span><span class="status-badge status-${s.estado}">${s.estado}</span>${s.tipo==='mensaje'?'<span class="mensaje-badge">‚úàÔ∏è Mensaje</span>":''}</div>
        </div>
      </div>
      <div class="song-actions">
        ${s.estado==='pendiente'?`<button class="act-btn act-approve" onclick="actualizar(${s.id},'aprobada')">‚úì Aprobar</button>`:''}
        <button class="act-btn act-next" onclick="enviarNextSong(${s.id},'${s.cancion.replace(/'/g,"\\'")}')">‚ö° Next Song</button>
        <button class="act-btn act-play" onclick="actualizar(${s.id},'reproducida')">‚ñ∂ Reproducida</button>
        <button class="act-btn act-reject" onclick="actualizar(${s.id},'rechazada')">‚úï Rechazar</button>
      </div>
    </div>`).join('');
}

async function actualizar(id, estado) {
  const res = await fetch(`/api/dj/estado/${id}`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:PASSWORD,estado}) });
  if (res.ok) { const s=solicitudes.find(x=>x.id===id); if(s)s.estado=estado; renderQueue(); }
}

async function enviarNextSong(id, cancion) {
  const res = await fetch(`/api/dj/next/${id}`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:PASSWORD}) });
  if (res.ok) showNotif(`‚ö° Next Song enviado: ${cancion}`,'warning');
}

function syncMsgBoards(el) {
  // Preview en tiempo real
  const preview = document.getElementById('msgPreview');
  if (preview) preview.textContent = el.value ? '‚Üí ' + el.value : '';
  // Sync con el textarea del drawer si existe
  const other = document.getElementById('djMessage');
  if (other && other !== el) other.value = el.value;
}

function addEmojiMain(emoji) {
  const ta = document.getElementById('djMessageMain');
  if (!ta) return;
  const pos = ta.selectionStart;
  ta.value = ta.value.slice(0, pos) + emoji + ta.value.slice(ta.selectionEnd);
  ta.selectionStart = ta.selectionEnd = pos + emoji.length;
  ta.focus();
  syncMsgBoards(ta);
}

async function sendMessageMain(color) {
  const texto = document.getElementById('djMessageMain').value.trim();
  if (!texto) { showNotif('Escribe un mensaje primero', 'error'); return; }
  const res = await fetch('/api/dj/message', {
    method: 'POST', headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({password: PASSWORD, texto, color})
  });
  if (res.ok) {
    showNotif('‚úÖ Mensaje enviado al display', 'success');
    const preview = document.getElementById('msgPreview');
    if (preview) preview.textContent = '‚úÖ Enviado: ' + texto;
  } else {
    showNotif('Error al enviar mensaje', 'error');
  }
}

async function clearMessageMain() {
  const res = await fetch('/api/dj/message', {
    method: 'POST', headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({password: PASSWORD, texto: '', color: 'white'})
  });
  if (res.ok) {
    document.getElementById('djMessageMain').value = '';
    const preview = document.getElementById('msgPreview');
    if (preview) preview.textContent = '';
    showNotif('Mensaje borrado', 'success');
  }
}

function showNotif(msg,type='') {
  const n=document.getElementById('notif'); n.textContent=msg; n.className=`notif show ${type}`;
  setTimeout(()=>n.classList.remove('show'),4000);
}
</script>
</body>
</html>
